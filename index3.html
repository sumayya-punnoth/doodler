<!DOCTYPE html>
<html>
  <head>
    <style>
      canvas {
        border: 1px solid black;
        image-rendering: pixelated;
        display: block;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="500" height="300"></canvas>

    <label>Size:</label>
    <input type="range" id="sizeRange" min="1" max="50" value="10" />

    <br /><br />

    <label>Color:</label>
    <input type="radio" name="colorRadio" value="black" checked /> Black
    <input type="radio" name="colorRadio" value="red" /> Red
    <input type="radio" name="colorRadio" value="blue" /> Blue
    <input type="radio" name="colorRadio" value="green" /> Green

    <br /><br />

    <input type="file" id="upload" accept="image/*" />
    <button id="clear">Clear</button>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const sizeElement = document.getElementById("sizeRange");
      let size = parseInt(sizeElement.value);
      sizeElement.oninput = (e) => {
        size = parseInt(e.target.value);
      };

      const colorRadios = document.getElementsByName("colorRadio");
      let color = "black";
      colorRadios.forEach((radio) => {
        if (radio.checked) color = radio.value;
        radio.onclick = () => {
          color = radio.value;
        };
      });

      let image = null;

      // Drawing state
      let isDrawing = false;

      canvas.onmousedown = (e) => {
        isDrawing = true;
        ctx.beginPath();
        ctx.lineWidth = size;
        ctx.strokeStyle = color;
        ctx.lineJoin = "round";
        ctx.lineCap = "round";
        ctx.moveTo(e.offsetX, e.offsetY);
      };

      canvas.onmousemove = (e) => {
        if (isDrawing) {
          ctx.lineTo(e.offsetX, e.offsetY);
          ctx.stroke();
        }
      };

      canvas.onmouseup = () => {
        isDrawing = false;
        ctx.closePath();
      };

      canvas.onmouseleave = () => {
        isDrawing = false;
        ctx.closePath();
      };

      // Clear button â€” keep image if present
      document.getElementById("clear").onclick = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (image) {
          ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
        }
      };

      // Upload and draw image
      const uploadInput = document.getElementById("upload");
      uploadInput.addEventListener("change", async (e) => {
        const file = uploadInput.files[0];
        if (!file) return;

        const img = new Image();
        img.src = await fileToDataURL(file);
        img.onload = () => {
          image = img;
          canvas.width = img.width;
          canvas.height = img.height;
          canvas.style.width = img.width + "px";
          canvas.style.height = img.height + "px";
          ctx.drawImage(img, 0, 0, img.width, img.height);
        };
      });

      function fileToDataURL(file) {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.readAsDataURL(file);
        });
      }
    </script>
  </body>
</html>
